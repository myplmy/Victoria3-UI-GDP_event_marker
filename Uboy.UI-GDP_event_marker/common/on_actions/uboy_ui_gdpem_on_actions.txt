# GDP Event Marker - On Actions
# 게임 시작 시 초기화 및 월별 이벤트 감지

on_game_start_tutorial_off = {
    on_actions = {
        event_marker_initialize
    }
}

event_marker_initialize = {
    effect = {
        # 게임 시작 년도 저장 (분기 인덱스 계산용)
        set_global_variable = {
            name = event_marker_game_start_year
            value = 1836  # 기본 시작 년도
        }
        
        # 모든 국가 초기화
        every_country = {
            event_marker_initialize_country = yes
        }
    }
}

# 월별 체크 (on_monthly_pulse)
on_monthly = {
    on_actions = {
        event_marker_monthly_check
    }
}

event_marker_monthly_check = {
    effect = {
        every_country = {
            limit = {
                # 플레이어 국가만 또는 주요 국가만 체크 (성능 최적화)
                OR = {
                    is_player = yes
                }
            }
        }
    }
}

# 외교전 시작 감지
on_diplomatic_play_started = {
    on_actions = {
        event_marker_diplomatic_play_started
    }
}

event_marker_diplomatic_play_started = {
    effect = {
        # 외교전 주도자
        scope:initiator = {
            event_marker_try_record_event = {
                EVENT_TYPE = 1  # 외교전 시작
            }
        }
        
        # 외교전 대상
        scope:target = {
            event_marker_try_record_event = {
                EVENT_TYPE = 1  # 외교전 시작 (방어)
            }
        }
    }
}

# 전쟁 시작 감지
on_war_started = {
    on_actions = {
        event_marker_war_started
    }
}

event_marker_war_started = {
    effect = {
        scope:diplomatic_play = {
            initiator = {
                save_scope_as = war_initiator
            }
        }
        
        # 공격자
        scope:war_initiator = {
            event_marker_try_record_event = {
                EVENT_TYPE = 2  # 전쟁 시작 (공격)
            }
        }
        
        # 방어자는 타겟들
        scope:target = {
            event_marker_try_record_event = {
                EVENT_TYPE = 2  # 전쟁 시작 (방어)
            }
        }
    }
}

# 기술 개발 감지
on_technology_researched = {
    on_actions = {
        event_marker_technology_researched
    }
}

event_marker_technology_researched = {
    effect = {
        scope:country = {
            # 모든 기술 개발을 기록
            event_marker_try_record_event = {
                EVENT_TYPE = 5
            }
        }
    }
}
